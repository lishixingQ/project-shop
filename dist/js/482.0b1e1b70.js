"use strict";(self["webpackChunkproject_shop"]=self["webpackChunkproject_shop"]||[]).push([[482],{3482:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("角色管理")]),t("el-breadcrumb-item",[e._v("角色列表")])],1),t("el-card",{staticClass:"box-card"},[t("el-button",{attrs:{type:"primary"},on:{click:e.addRole}},[e._v("添加角色")]),[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.rolesListData,border:"",stripe:""}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(s){return e._l(s.row.children,(function(a,o){return t("el-row",{key:a.id,class:["bborder",0===o?"tborder":"","vdisflex"]},[t("el-col",{attrs:{span:5}},[t("el-tag",{attrs:{closable:""},on:{close:function(t){return e.deleteRight(s.row,a.id)}}},[e._v(e._s(a.authName))]),t("i",{staticClass:"el-icon-caret-right"})],1),t("el-col",{attrs:{span:19}},e._l(a.children,(function(a,o){return t("el-row",{key:a.id,class:[0===o?"":"tborder","vdisflex"]},[t("el-col",{attrs:{span:6}},[t("el-tag",{attrs:{type:"success",closable:""},on:{close:function(t){return e.deleteRight(s.row,a.id)}}},[e._v(" "+e._s(a.authName)+" ")]),t("i",{staticClass:"el-icon-caret-right"})],1),t("el-col",{attrs:{span:13}},e._l(a.children,(function(a){return t("el-tag",{key:a.id,attrs:{type:"warning",closable:""},on:{close:function(t){return e.deleteRight(s.row,a.id)}}},[e._v(" "+e._s(a.authName)+" ")])})),1)],1)})),1)],1)}))}}])}),t("el-table-column",{attrs:{type:"index"}}),t("el-table-column",{attrs:{prop:"roleName",label:"角色名称"}}),t("el-table-column",{attrs:{prop:"roleDesc",label:"角色描述"}}),t("el-table-column",{attrs:{label:"操作",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(t){return e.changeRole(s.row.id)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(t){return e.deleteRole(s.row.id)}}},[e._v("删除")]),t("el-button",{attrs:{type:"warning",icon:"el-icon-search",size:"mini"},on:{click:function(t){return e.setRights(s.row)}}},[e._v("分配权限")])]}}])})],1)]],2),t("el-dialog",{attrs:{title:"添加角色",visible:e.addRoleDialog,width:"30%"},on:{"update:visible":function(t){e.addRoleDialog=t}}},[t("el-form",{ref:"addRolesFormRef",attrs:{model:e.addRolesForm,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"角色名称"}},[t("el-input",{model:{value:e.addRolesForm.roleName,callback:function(t){e.$set(e.addRolesForm,"roleName",t)},expression:"addRolesForm.roleName"}})],1),t("el-form-item",{attrs:{label:"角色描述"}},[t("el-input",{model:{value:e.addRolesForm.roleDesc,callback:function(t){e.$set(e.addRolesForm,"roleDesc",t)},expression:"addRolesForm.roleDesc"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addRoleDialog=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmAddRoles}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"修改角色",visible:e.changeRoleDialog,width:"30%"},on:{"update:visible":function(t){e.changeRoleDialog=t}}},[t("el-form",{ref:"changeRolesFormRef",attrs:{model:e.changeRolesForm,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"角色名称"}},[t("el-input",{model:{value:e.changeRolesForm.roleName,callback:function(t){e.$set(e.changeRolesForm,"roleName",t)},expression:"changeRolesForm.roleName"}})],1),t("el-form-item",{attrs:{label:"角色描述"}},[t("el-input",{model:{value:e.changeRolesForm.roleDesc,callback:function(t){e.$set(e.changeRolesForm,"roleDesc",t)},expression:"changeRolesForm.roleDesc"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.changeRoleDialog=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmChangeRoles}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"分配权限",visible:e.setRightsDialog,width:"50%"},on:{"update:visible":function(t){e.setRightsDialog=t},close:e.setRightsDialogClosed}},[t("el-tree",{ref:"treeRef",attrs:{data:e.allRightsTree,props:e.allRightsTreeProps,"show-checkbox":"","default-expand-all":"","node-key":"id","default-checked-keys":e.defKeys}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.setRightsDialog=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmSetRights}},[e._v("确 定")])],1)],1)],1)},o=[],l=(s(7658),{props:{},data(){return{rolesListData:[],addRoleDialog:!1,addRolesForm:{roleName:"",roleDesc:""},changeRoleDialog:!1,changeRolesForm:{},setRightsDialog:!1,allRightsTree:[],allRightsTreeProps:{label:"authName",children:"children"},defKeys:[],roleId:""}},methods:{async getRolesListData(){const{data:e}=await this.$axios.get("roles");200==e.meta.status?this.rolesListData=e.data:this.$message.error("获取角色列表失败！")},addRole(){this.addRoleDialog=!0},async confirmAddRoles(){const{data:e}=await this.$axios.post("roles",this.addRolesForm);201==e.meta.status?this.$message.success("添加角色成功!"):this.$message.error("添加角色失败!"),this.getRolesListData(),this.addRoleDialog=!1},async changeRole(e){const{data:t}=await this.$axios.get(`roles/${e}`);200==t.meta.status?(this.$message.success("获取角色成功!"),this.changeRolesForm=t.data,this.changeRoleDialog=!0):this.$message.error("获取角色失败!")},async confirmChangeRoles(){const{data:e}=await this.$axios.put(`roles/${this.changeRolesForm.roleId}`,{roleName:this.changeRolesForm.roleName,roleDesc:this.changeRolesForm.roleDesc});200==e.meta.status?(this.$message.success("修改用户信息成功!"),this.getRolesListData()):this.$message.error("修改用户信息失败!"),this.changeRoleDialog=!1},async deleteRole(e){const t=await this.$confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((e=>e));if("confirm"==t){const{data:t}=await this.$axios.delete(`roles/${e}`);200==t.meta.status?(this.$message.success("删除用户成功!"),this.getRolesListData()):this.$message.error("删除用户失败!")}"cancel"==t&&this.$message("已取消删除角色!")},async deleteRight(e,t){const s=await this.$confirm("此操作将永久删除该权限, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((e=>e));if("confirm"!=s)return this.$message("已取消删除权限!");const{data:a}=await this.$axios.delete(`roles/${e.id}/rights/${t}`);if(200!=a.meta.status)return this.$message.error("删除权限失败!");this.$message.success("删除权限成功!"),e.children=a.data},async setRights(e){this.roleId=e.id,console.log(e);const{data:t}=await this.$axios.get("rights/tree");if(200!=t.meta.status)return this.$message.error("获取权限列表失败！");this.$message.success("获取权限列表成功！"),this.allRightsTree=t.data,this.getThirdListId(e,this.defKeys),this.setRightsDialog=!0},getThirdListId(e,t){if(!e.children)return t.push(e.id);e.children.forEach((e=>this.getThirdListId(e,t)))},setRightsDialogClosed(){this.defKeys=[]},async confirmSetRights(){const e=[...this.$refs.treeRef.getCheckedKeys(),...this.$refs.treeRef.getHalfCheckedKeys()],t=e.join(","),{data:s}=await this.$axios.post(`roles/${this.roleId}/rights`,{rids:t});if(200!=s.meta.status)return this.$message.error("更新权限失败！");this.$message.success("更新权限成功！"),this.getRolesListData(),this.setRightsDialog=!1}},mounted(){this.getRolesListData()},components:{}}),i=l,r=s(1001),n=(0,r.Z)(i,a,o,!1,null,"c0c1a1a2",null),c=n.exports}}]);
//# sourceMappingURL=482.0b1e1b70.js.map